# Accurate Health Monitoring Makefile
# Commands using the new accurate health check system

.PHONY: help status status-accurate health check-accurate

# Colors
GREEN := \033[0;32m
BLUE := \033[0;34m
YELLOW := \033[1;33m
NC := \033[0m

help: ## Show available commands
	@echo "üè• Accurate Health Monitoring Commands"
	@echo "======================================"
	@echo ""
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "$(BLUE)%-20s$(NC) %s\n", $$1, $$2}'

PYTHON ?= python3
VENV ?= venv_hardening

status-accurate: ## Accurate health check using unified monitoring
	@echo "$(BLUE)üè• Running Accurate Health Check...$(NC)"
	source $(VENV)/bin/activate && python3 scripts/safeguards/unified_health_monitor.py

health: status-accurate ## Alias for accurate status

check-accurate: ## Quick accurate check of key services
	@echo "$(BLUE)üéØ Quick Accurate Check...$(NC)"
	@echo ""
	@echo "Core Services:"
	source $(VENV)/bin/activate && python3 scripts/safeguards/unified_health_monitor.py | grep -E "(redis|orchestrator|llm-gateway|discovery-agent)" | head -4
	@echo ""
	source $(VENV)/bin/activate && python3 scripts/safeguards/unified_health_monitor.py | grep -E "Health Percentage|Status:"

compare-health: ## Compare health monitoring methods
	@echo "$(YELLOW)üìä Comparing Health Check Methods$(NC)"
	@echo "===================================="
	@echo ""
	@echo "$(BLUE)Unified Health Monitor:$(NC)"
	source $(VENV)/bin/activate && python3 scripts/safeguards/unified_health_monitor.py | grep -E "Health Percentage|Status:" | tail -2

monitor-accurate: ## Start continuous accurate monitoring
	@echo "$(BLUE)üì° Starting Accurate Continuous Monitoring...$(NC)"
	@echo "Press Ctrl+C to stop"
	@while true; do \
		clear; \
		echo "$(BLUE)üè• Live Accurate Health Status - $$(date)$(NC)"; \
		echo "=========================================="; \
		source $(VENV)/bin/activate && python3 scripts/safeguards/unified_health_monitor.py; \
		echo ""; \
		echo "Next update in 30 seconds..."; \
		sleep 30; \
	done

# Default target
.DEFAULT_GOAL := help
